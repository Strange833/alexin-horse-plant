{% extends 'main/base.html' %}
{% load static %}

{% block title %}–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ—à–∞–¥–µ–π - –ê–ª–µ–∫—Å–∏–Ω—Å–∫–∏–π –∫–æ–Ω–Ω—ã–π –∑–∞–≤–æ–¥{% endblock %}

{% block extra_css %}
<style>
    /* –ö–æ–º–ø–∞–∫—Ç–Ω—ã–π –≥–µ—Ä–æ–π-–±–∞–Ω–Ω–µ—Ä */
    .compact-hero {
        position: relative;
        margin: 1.5rem;
        border-radius: 1rem;
        overflow: hidden;
        box-shadow: 0 0.5rem 1.5rem rgba(0, 0, 0, 0.2);
        background: linear-gradient(135deg, #2d5016, #4a7c2a);
        height: 220px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .compact-hero-content {
        position: relative;
        z-index: 2;
        text-align: center;
        padding: 2rem;
        max-width: 800px;
    }

    .compact-hero-title {
        font-size: 2.5rem;
        font-weight: 800;
        margin-bottom: 0.5rem;
        color: white;
        text-shadow: 2px 2px 6px rgba(0, 0, 0, 0.6);
        letter-spacing: 0.5px;
    }

    .compact-hero-subtitle {
        font-size: 1.2rem;
        color: rgba(255, 255, 255, 0.95);
        line-height: 1.4;
        max-width: 600px;
        margin: 0 auto;
    }

    /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –ø–æ–¥–ø–∏—Å–∫–µ */
    .subscription-notice {
        background: linear-gradient(135deg, rgba(76, 175, 80, 0.15), rgba(139, 195, 74, 0.2));
        border: 2px solid #4caf50;
        border-radius: 1rem;
        padding: 1.2rem;
        margin: 1.5rem;
        text-align: center;
        box-shadow: 0 4px 15px rgba(76, 175, 80, 0.25);
        backdrop-filter: blur(10px);
        position: relative;
        overflow: hidden;
    }

    .subscription-notice:before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, #4caf50, #8bc34a);
    }

    .subscription-notice strong {
        color: #2d5016;
        font-size: 1.1rem;
        font-weight: 700;
        display: block;
        margin-bottom: 0.5rem;
    }

    .subscription-link {
        color: #4caf50;
        font-weight: 700;
        text-decoration: none;
        border-bottom: 2px solid #4caf50;
        padding-bottom: 2px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 1rem;
        display: inline-block;
        margin-top: 0.5rem;
    }

    .subscription-link:hover {
        color: #2d5016;
        border-bottom-color: #2d5016;
        transform: translateY(-1px);
    }

    /* –£–õ–£–ß–®–ï–ù–ù–ê–Ø –°–ï–¢–ö–ê - –ö–ê–†–¢–û–ß–ö–ò –ö–ê–ö –ü–†–Ø–ú–û–£–ì–û–õ–¨–ù–ò–ö–ò */
    .compact-horses-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(450px, 1fr));
        gap: 2rem;
        margin: 2rem 1.5rem;
        max-width: 1400px;
        margin-left: auto;
        margin-right: auto;
    }

    /* –£–õ–£–ß–®–ï–ù–ù–´–ï –ö–ê–†–¢–û–ß–ö–ò - –®–ò–†–û–ö–ò–ï –ü–†–Ø–ú–û–£–ì–û–õ–¨–ù–ò–ö–ò */
    .compact-horse-card {
        background: rgba(255, 255, 255, 0.98);
        border-radius: 1.2rem;
        overflow: hidden;
        box-shadow: 0 0.5rem 1.5rem rgba(0, 0, 0, 0.12);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        cursor: pointer;
        height: 280px; /* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤—ã—Å–æ—Ç–∞ –¥–ª—è –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∞ */
        display: flex;
        flex-direction: row; /* –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ */
        border: 1px solid rgba(0, 0, 0, 0.08);
        transform: translateY(0);
        position: relative;
    }

    .compact-horse-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 1rem 2.5rem rgba(0, 0, 0, 0.18);
        border-color: rgba(76, 175, 80, 0.3);
    }

    /* –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–ª–µ–≤–∞ - 40% —à–∏—Ä–∏–Ω—ã */
    .compact-horse-image-container {
        width: 40%;
        height: 100%;
        overflow: hidden;
        position: relative;
        flex-shrink: 0;
    }

    .compact-horse-image {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .compact-horse-card:hover .compact-horse-image {
        transform: scale(1.08);
    }

    .compact-availability-badge {
        position: absolute;
        top: 1rem;
        right: 1rem;
        padding: 0.5rem 1rem;
        border-radius: 2rem;
        font-size: 0.8rem;
        font-weight: 700;
        color: white;
        z-index: 2;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .compact-available {
        background: linear-gradient(135deg, #4caf50, #2e7d32);
    }

    .compact-busy {
        background: linear-gradient(135deg, #f44336, #d32f2f);
    }

    /* –ö–æ–Ω—Ç–µ–Ω—Ç —Å–ø—Ä–∞–≤–∞ - 60% —à–∏—Ä–∏–Ω—ã */
    .compact-horse-content {
        padding: 1.5rem;
        flex-grow: 1;
        display: flex;
        flex-direction: column;
        width: 60%;
    }

    .compact-horse-name {
        color: #2d5016;
        font-size: 1.5rem;
        font-weight: 800;
        margin-bottom: 0.4rem;
        line-height: 1.2;
        letter-spacing: -0.2px;
    }

    .compact-horse-breed {
        color: #4a7c2a;
        font-weight: 700;
        font-size: 1rem;
        margin-bottom: 0.8rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .compact-horse-breed:before {
        content: 'üêé';
        font-size: 0.9rem;
    }

    .compact-horse-description {
        color: #666;
        line-height: 1.5;
        font-size: 0.95rem;
        margin-bottom: 1rem;
        flex-grow: 1;
        max-height: 80px;
        overflow: hidden;
    }

    .compact-price-info {
        margin-bottom: 1rem;
        padding: 1rem;
        background: rgba(139, 195, 74, 0.05);
        border-radius: 0.8rem;
        border: 1px solid rgba(139, 195, 74, 0.1);
    }

    .compact-price-with-discount {
        display: flex;
        align-items: center;
        gap: 0.8rem;
        margin-bottom: 0.5rem;
        flex-wrap: wrap;
    }

    .compact-original-price {
        text-decoration: line-through;
        color: #999;
        font-size: 0.95rem;
        font-weight: 500;
    }

    .compact-discounted-price {
        color: #2d5016;
        font-weight: 800;
        font-size: 1.4rem;
        background: linear-gradient(135deg, #4caf50, #8bc34a);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .compact-subscription-benefit {
        background: linear-gradient(135deg, #4caf50, #8bc34a);
        color: white;
        padding: 0.3rem 0.8rem;
        border-radius: 2rem;
        font-size: 0.8rem;
        font-weight: 700;
        display: inline-block;
        box-shadow: 0 2px 5px rgba(76, 175, 80, 0.3);
    }

    .compact-horse-subscription-info {
        background: linear-gradient(135deg, rgba(255, 193, 7, 0.1), rgba(255, 193, 7, 0.05));
        border: 1px solid rgba(255, 193, 7, 0.3);
        border-radius: 0.8rem;
        padding: 0.8rem;
        margin-top: 0.5rem;
        font-size: 0.85rem;
        line-height: 1.4;
        color: #5d4037;
        position: relative;
        overflow: hidden;
    }

    .compact-horse-subscription-info:before {
        content: '‚ö°';
        position: absolute;
        top: 0.8rem;
        right: 0.8rem;
        font-size: 1rem;
        opacity: 0.2;
    }

    .compact-horse-subscription-info strong {
        color: #ff9800;
        font-weight: 700;
    }

    .compact-btn-book {
        background: linear-gradient(135deg, #4caf50, #2e7d32);
        color: white;
        border: none;
        padding: 1rem 1.5rem;
        border-radius: 2rem;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        width: 100%;
        font-size: 1rem;
        margin-top: auto;
        letter-spacing: 0.5px;
        text-transform: uppercase;
        box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
        position: relative;
        overflow: hidden;
    }

    .compact-btn-book:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
        background: linear-gradient(135deg, #66bb6a, #388e3c);
    }

    .compact-btn-book:disabled {
        background: #bdbdbd;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
    }

    .compact-btn-book.auth-required {
        background: linear-gradient(135deg, #ff9800, #f57c00);
        box-shadow: 0 4px 12px rgba(255, 152, 0, 0.3);
    }

    .compact-btn-book.auth-required:hover {
        background: linear-gradient(135deg, #ffa726, #f57c00);
        box-shadow: 0 6px 20px rgba(255, 152, 0, 0.4);
    }

    /* –ö–∞–ª–µ–Ω–¥–∞—Ä—å –∏ –≤—ã–±–æ—Ä –≤—Ä–µ–º–µ–Ω–∏ */
    .calendar-section {
        margin: 2rem 0;
    }

    .calendar-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
        padding: 0 0.5rem;
    }

    .calendar-nav {
        display: flex;
        gap: 1rem;
        align-items: center;
    }

    .calendar-nav-btn {
        background: linear-gradient(135deg, #4caf50, #8bc34a);
        color: white;
        border: none;
        padding: 0.8rem 1.2rem;
        border-radius: 0.8rem;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 600;
        font-size: 0.9rem;
        box-shadow: 0 2px 8px rgba(76, 175, 80, 0.2);
    }

    .calendar-nav-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
    }

    .calendar-title {
        font-size: 1.4rem;
        font-weight: 700;
        color: #2d5016;
        min-width: 200px;
        text-align: center;
    }

    .calendar-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 8px;
        margin-bottom: 1.5rem;
        background: rgba(255, 255, 255, 0.5);
        padding: 1.5rem;
        border-radius: 1.2rem;
        border: 1px solid rgba(0, 0, 0, 0.05);
    }

    .calendar-day {
        padding: 0.8rem 0.5rem;
        text-align: center;
        font-weight: 600;
        color: #2d5016;
        background: rgba(76, 175, 80, 0.1);
        border-radius: 0.5rem;
        font-size: 0.9rem;
    }

    .calendar-date {
        padding: 1rem 0.5rem;
        text-align: center;
        border-radius: 0.8rem;
        cursor: pointer;
        transition: all 0.3s ease;
        border: 2px solid transparent;
        font-weight: 500;
        font-size: 0.95rem;
    }

    .calendar-date.available {
        background: rgba(76, 175, 80, 0.1);
        color: #2d5016;
        border-color: rgba(76, 175, 80, 0.3);
    }

    .calendar-date.available:hover {
        background: rgba(76, 175, 80, 0.2);
        transform: translateY(-2px);
    }

    .calendar-date.unavailable {
        background: rgba(244, 67, 54, 0.1);
        color: #999;
        cursor: not-allowed;
        border-color: rgba(244, 67, 54, 0.3);
    }

    .calendar-date.other-month {
        color: #ccc;
        background: rgba(0, 0, 0, 0.05);
    }

    .calendar-date.past {
        background: rgba(0, 0, 0, 0.05) !important;
        color: #ccc !important;
        border-color: #e0e0e0 !important;
        cursor: not-allowed !important;
        text-decoration: line-through;
    }

    .calendar-date.selected {
        background: linear-gradient(135deg, #4caf50, #8bc34a);
        color: white;
        transform: scale(1.05);
        border-color: #4caf50;
        box-shadow: 0 4px 15px rgba(76, 175, 80, 0.4);
        font-weight: 700;
    }

    .calendar-date.today {
        border: 2px solid #ff9800;
        background: rgba(255, 152, 0, 0.1);
        color: #ff9800;
        font-weight: 700;
    }

    .time-slots {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
        gap: 0.8rem;
        margin-top: 1.5rem;
    }

    .time-slot {
        padding: 1rem;
        text-align: center;
        border: 2px solid #e0e0e0;
        border-radius: 0.8rem;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 500;
        background: white;
    }

    .time-slot.available {
        border-color: #4caf50;
        color: #2d5016;
        background: rgba(76, 175, 80, 0.1);
    }

    .time-slot.available:hover {
        background: rgba(76, 175, 80, 0.2);
        transform: translateY(-2px);
    }

    .time-slot.selected {
        background: linear-gradient(135deg, #4caf50, #8bc34a);
        color: white;
        border-color: #4caf50;
        transform: scale(1.05);
        box-shadow: 0 4px 15px rgba(76, 175, 80, 0.4);
        font-weight: 700;
    }

    .time-slot.unavailable {
        background: rgba(244, 67, 54, 0.1);
        color: #999;
        border-color: rgba(244, 67, 54, 0.3);
        cursor: not-allowed;
    }

    /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
    .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.75);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 1001;
        padding: 1rem;
        backdrop-filter: blur(5px);
    }

    .modal-overlay.active {
        display: flex;
        animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }

    .modal-content {
        background: white;
        border-radius: 1.5rem;
        max-width: 800px;
        width: 100%;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: 0 2rem 5rem rgba(0, 0, 0, 0.4);
        position: relative;
        animation: slideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    @keyframes slideUp {
        from { transform: translateY(50px); opacity: 0; }
        to { transform: translateY(0); opacity: 1; }
    }

    .modal-close {
        position: absolute;
        top: 1rem;
        right: 1rem;
        background: #f44336;
        color: white;
        border: none;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        font-size: 1.5rem;
        cursor: pointer;
        z-index: 1002;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        box-shadow: 0 2px 8px rgba(244, 67, 54, 0.3);
    }

    .modal-close:hover {
        background: #d32f2f;
        transform: rotate(90deg);
    }

    .modal-header {
        padding: 2rem 2rem 1rem 2rem;
        border-bottom: 2px solid #e8f5e9;
        background: linear-gradient(135deg, #f1f8e9, #e8f5e9);
        border-radius: 1.5rem 1.5rem 0 0;
    }

    .modal-title {
        color: #2d5016;
        font-size: 1.8rem;
        font-weight: 800;
        margin-bottom: 0.5rem;
        text-align: center;
    }

    .modal-subtitle {
        color: #666;
        font-size: 1.1rem;
        text-align: center;
        line-height: 1.4;
    }

    .modal-body {
        padding: 1.5rem 2rem 2rem 2rem;
    }

    /* –°–æ–æ–±—â–µ–Ω–∏–µ –æ –ø—É—Å—Ç–æ–º —Å–ø–∏—Å–∫–µ */
    .empty-state {
        text-align: center;
        color: white;
        padding: 4rem 2rem;
        grid-column: 1 / -1;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 1.5rem;
        margin: 2rem;
    }

    .empty-state h3 {
        font-size: 2rem;
        margin-bottom: 1rem;
        font-weight: 700;
    }

    .empty-state p {
        font-size: 1.2rem;
        opacity: 0.9;
        margin-bottom: 2rem;
    }

    .btn-contact {
        display: inline-block;
        background: linear-gradient(135deg, #4caf50, #8bc34a);
        color: white;
        padding: 1rem 2rem;
        border-radius: 2rem;
        text-decoration: none;
        font-weight: 600;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
    }

    .btn-contact:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è —ç–∫—Ä–∞–Ω–æ–≤ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è */
    .booking-screens-container {
        display: none;
    }

    .booking-screens-container.active {
        display: block;
    }

    .screen {
        display: none;
        animation: fadeIn 0.5s ease;
    }

    .screen.active {
        display: block;
    }

    /* –≠–∫—Ä–∞–Ω –¥–µ—Ç–∞–ª–µ–π –ª–æ—à–∞–¥–∏ —Å –∫–∞–ª–µ–Ω–¥–∞—Ä–µ–º */
    .horse-details-screen {
        background: rgba(255, 255, 255, 0.98);
        border-radius: 1.5rem;
        margin: 2rem;
        padding: 2.5rem;
        box-shadow: 0 0.5rem 2rem rgba(0, 0, 0, 0.1);
        max-width: 1200px;
        margin-left: auto;
        margin-right: auto;
    }

    .horse-details-header {
        display: flex;
        gap: 2.5rem;
        margin-bottom: 2.5rem;
        flex-wrap: wrap;
    }

    .horse-details-image {
        flex: 1;
        min-width: 300px;
    }

    .horse-details-image img {
        width: 100%;
        height: 350px;
        object-fit: cover;
        border-radius: 1.2rem;
        box-shadow: 0 0.5rem 1.5rem rgba(0, 0, 0, 0.15);
    }

    .horse-details-info {
        flex: 1;
        min-width: 300px;
    }

    .horse-details-info h2 {
        color: #2d5016;
        font-size: 2rem;
        font-weight: 800;
        margin-bottom: 0.5rem;
    }

    .horse-details-breed {
        color: #4a7c2a;
        font-size: 1.2rem;
        font-weight: 700;
        margin-bottom: 1.5rem;
        display: flex;
        align-items: center;
        gap: 0.8rem;
    }

    .horse-characteristics {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin: 1.5rem 0;
    }

    .characteristic-card {
        background: rgba(76, 175, 80, 0.1);
        padding: 1.2rem;
        border-radius: 1rem;
        border-left: 4px solid #4caf50;
    }

    .characteristic-card h4 {
        color: #2d5016;
        font-size: 0.9rem;
        margin-bottom: 0.5rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .characteristic-card p {
        color: #333;
        font-size: 1.1rem;
        font-weight: 600;
    }

    /* –§–æ—Ä–º–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è */
    .booking-form-container {
        background: white;
        border-radius: 1.5rem;
        margin: 2rem;
        padding: 2.5rem;
        box-shadow: 0 0.5rem 2rem rgba(0, 0, 0, 0.1);
        max-width: 800px;
        margin-left: auto;
        margin-right: auto;
    }

    .booking-summary-card {
        background: linear-gradient(135deg, #e8f5e9, #f1f8e9);
        border-radius: 1.2rem;
        padding: 2rem;
        margin-bottom: 2.5rem;
        border: 2px solid #c8e6c9;
        box-shadow: 0 4px 20px rgba(76, 175, 80, 0.1);
    }

    .booking-summary-card h3 {
        color: #2d5016;
        font-size: 1.6rem;
        margin-bottom: 1.5rem;
        text-align: center;
        font-weight: 700;
    }

    .summary-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1.2rem;
        border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        font-size: 1.05rem;
    }

    .summary-row:last-child {
        border-bottom: none;
        border-top: 2px solid #4caf50;
        margin-top: 0.5rem;
        padding-top: 1.5rem;
        font-size: 1.2rem;
    }

    .summary-label {
        color: #666;
        font-weight: 500;
    }

    .summary-value {
        color: #2d5016;
        font-weight: 600;
    }

    .summary-total {
        font-weight: 800;
        color: #2e7d32;
        font-size: 1.4rem;
    }

    /* –§–æ—Ä–º–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è */
    .booking-form {
        background: white;
        border-radius: 1.2rem;
        padding: 2rem;
        box-shadow: 0 0.3rem 1.2rem rgba(0, 0, 0, 0.08);
        border: 1px solid #e0e0e0;
    }

    .form-group {
        margin-bottom: 2rem;
        position: relative;
    }

    .form-group label {
        display: block;
        margin-bottom: 0.8rem;
        font-weight: 600;
        color: #2d5016;
        font-size: 1.05rem;
    }

    .form-group input,
    .form-group textarea {
        width: 100%;
        padding: 1.2rem;
        border: 2px solid #e0e0e0;
        border-radius: 0.8rem;
        font-size: 1rem;
        transition: all 0.3s ease;
        font-family: inherit;
        background: #f9f9f9;
    }

    .form-group input:focus,
    .form-group textarea:focus {
        outline: none;
        border-color: #4caf50;
        box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
        background: white;
    }

    /* –ü–æ–ª–µ –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ */
    .phone-input-container {
        position: relative;
    }

    .phone-prefix {
        position: absolute;
        left: 1.2rem;
        top: 50%;
        transform: translateY(-50%);
        color: #666;
        font-weight: 600;
        pointer-events: none;
        z-index: 2;
        font-size: 1.05rem;
    }

    .phone-input {
        padding-left: 4rem !important;
        letter-spacing: 1px;
        font-family: 'Courier New', monospace;
        font-weight: 500;
        font-size: 1.1rem;
    }

    .phone-input::placeholder {
        color: #999;
        font-family: inherit;
    }

    .phone-hint {
        font-size: 0.9rem;
        color: #666;
        margin-top: 0.5rem;
        display: block;
        opacity: 0.8;
    }

    .validation-error {
        color: #f44336;
        font-size: 0.9rem;
        margin-top: 0.5rem;
        display: none;
        font-weight: 500;
    }

    .validation-success {
        color: #4caf50;
        font-size: 0.9rem;
        margin-top: 0.5rem;
        display: none;
        font-weight: 500;
    }

    .input-error {
        border-color: #f44336 !important;
        background-color: rgba(244, 67, 54, 0.05);
    }

    .input-success {
        border-color: #4caf50 !important;
        background-color: rgba(76, 175, 80, 0.05);
    }

    /* –ß–µ–∫–±–æ–∫—Å —Å–æ–≥–ª–∞—Å–∏—è - –£–õ–£–ß–®–ï–ù–ù–´–ô */
    .terms-checkbox {
        display: flex;
        align-items: center;
        gap: 1.2rem;
        margin: 2.5rem 0;
        padding: 1.5rem;
        background: #f9f9f9;
        border-radius: 1.2rem;
        border: 2px solid #e0e0e0;
        transition: all 0.3s ease;
        cursor: pointer;
    }

    .terms-checkbox:hover {
        border-color: #4caf50;
        background: #f5f9f5;
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }

    .terms-checkbox input[type="checkbox"] {
        width: 28px;
        height: 28px;
        min-width: 28px;
        cursor: pointer;
        accent-color: #4caf50;
        border: 2px solid #bdbdbd;
        border-radius: 8px;
        transition: all 0.3s ease;
    }

    .terms-checkbox input[type="checkbox"]:checked {
        background-color: #4caf50;
        border-color: #4caf50;
        box-shadow: 0 2px 8px rgba(76, 175, 80, 0.3);
    }

    .terms-checkbox label {
        margin: 0;
        font-weight: 500;
        color: #333;
        line-height: 1.5;
        cursor: pointer;
        flex: 1;
        font-size: 1.05rem;
    }

    .terms-link {
        color: #4caf50;
        font-weight: 700;
        text-decoration: none;
        border-bottom: 2px solid transparent;
        transition: all 0.3s ease;
        display: inline-block;
        margin-left: 0.3rem;
    }

    .terms-link:hover {
        color: #2d5016;
        border-bottom-color: #2d5016;
    }

    /* –ö–Ω–æ–ø–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ */
    .navigation-controls {
        display: flex;
        justify-content: space-between;
        gap: 1.5rem;
        margin-top: 2.5rem;
    }

    .btn {
        padding: 1.2rem 2.5rem;
        border: none;
        border-radius: 2rem;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 0.8rem;
        min-width: 180px;
        font-size: 1.1rem;
        letter-spacing: 0.5px;
    }

    .btn-primary {
        background: linear-gradient(135deg, #4caf50, #2e7d32);
        color: white;
        box-shadow: 0 4px 20px rgba(76, 175, 80, 0.3);
    }

    .btn-primary:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 25px rgba(76, 175, 80, 0.4);
    }

    .btn-secondary {
        background: white;
        color: #2d5016;
        border: 2px solid #4caf50;
        box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
    }

    .btn-secondary:hover {
        background: #f5f9f5;
        transform: translateY(-3px);
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
    }

    /* –≠–∫—Ä–∞–Ω –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è */
    .confirmation-screen {
        background: rgba(255, 255, 255, 0.98);
        border-radius: 1.5rem;
        margin: 2rem;
        padding: 3rem;
        box-shadow: 0 0.5rem 2rem rgba(0, 0, 0, 0.1);
        text-align: center;
        max-width: 800px;
        margin-left: auto;
        margin-right: auto;
    }

    .success-icon {
        font-size: 5rem;
        color: #4caf50;
        margin-bottom: 1.5rem;
        animation: bounce 1s ease;
    }

    @keyframes bounce {
        0%, 20%, 50%, 80%, 100% {transform: translateY(0);}
        40% {transform: translateY(-20px);}
        60% {transform: translateY(-10px);}
    }

    .confirmation-title {
        color: #2d5016;
        font-size: 2.2rem;
        font-weight: 800;
        margin-bottom: 1rem;
    }

    .booking-status {
        display: inline-block;
        padding: 1rem 2.5rem;
        border-radius: 2rem;
        font-weight: 700;
        margin-bottom: 2rem;
        font-size: 1.1rem;
        letter-spacing: 0.5px;
    }

    .status-confirmed {
        background: rgba(76, 175, 80, 0.2);
        color: #2e7d32;
        border: 2px solid #4caf50;
    }

    .booking-number {
        background: linear-gradient(135deg, #4caf50, #8bc34a);
        color: white;
        padding: 1.2rem 2.5rem;
        border-radius: 2rem;
        font-weight: 700;
        display: inline-block;
        margin-bottom: 2rem;
        font-size: 1.3rem;
        box-shadow: 0 4px 20px rgba(76, 175, 80, 0.3);
    }

    /* Responsive Design */
    @media (max-width: 1024px) {
        .compact-horses-grid {
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
        }
    }

    @media (max-width: 768px) {
        .compact-hero {
            height: 180px;
            margin: 1rem;
        }

        .compact-hero-title {
            font-size: 2rem;
        }

        .compact-hero-subtitle {
            font-size: 1rem;
        }

        .compact-horses-grid {
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 1.5rem;
            margin: 1.5rem 1rem;
        }

        .compact-horse-card {
            flex-direction: column;
            height: auto;
        }

        .compact-horse-image-container {
            width: 100%;
            height: 220px;
        }

        .compact-horse-content {
            width: 100%;
        }

        .subscription-notice {
            margin: 1rem;
            padding: 1rem;
        }

        .horse-details-header {
            flex-direction: column;
        }

        .horse-details-image,
        .horse-details-info {
            min-width: 100%;
        }

        .booking-form-container,
        .confirmation-screen {
            margin: 1rem;
            padding: 1.5rem;
        }

        .navigation-controls {
            flex-direction: column;
        }

        .btn {
            width: 100%;
        }

        .calendar-grid {
            padding: 1rem;
            gap: 5px;
        }

        .calendar-date {
            padding: 0.8rem 0.3rem;
            font-size: 0.85rem;
        }
    }

    @media (max-width: 480px) {
        .compact-horses-grid {
            grid-template-columns: 1fr;
        }

        .compact-hero {
            height: 160px;
        }

        .compact-hero-title {
            font-size: 1.6rem;
        }

        .compact-hero-content {
            padding: 1rem;
        }

        .time-slots {
            grid-template-columns: repeat(2, 1fr);
        }
    }

    @media (min-width: 1400px) {
        .compact-horses-grid {
            grid-template-columns: repeat(2, 1fr);
            max-width: 1400px;
        }
    }
</style>
{% endblock %}

{% block content %}
    <!-- –ö–æ–º–ø–∞–∫—Ç–Ω—ã–π –≥–µ—Ä–æ–π-–±–∞–Ω–Ω–µ—Ä -->
    <div class="compact-hero">
        <div class="compact-hero-content">
            <h1 class="compact-hero-title">–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ—à–∞–¥–µ–π</h1>
            <p class="compact-hero-subtitle">–í—ã–±–µ—Ä–∏—Ç–µ —Å–≤–æ—é –ª–æ—à–∞–¥—å –∏ –ø–æ–ª—É—á–∏—Ç–µ —Å–∫–∏–¥–∫—É —Å –ø–æ–¥–ø–∏—Å–∫–æ–π</p>
        </div>
    </div>

    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –ø–æ–¥–ø–∏—Å–∫–µ -->
    <div class="subscription-notice">
        <strong>–≠–∫–æ–Ω–æ–º—å—Ç–µ –¥–æ 25% —Å –ø–æ–¥–ø–∏—Å–∫–æ–π!</strong> 
        <a class="subscription-link" onclick="showSubscriptionModal()">–£–∑–Ω–∞—Ç—å –æ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞—Ö –ø–æ–¥–ø–∏—Å–∫–∏ ‚Üí</a>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π —ç–∫—Ä–∞–Ω —Å –ª–æ—à–∞–¥—å–º–∏ -->
    <div id="main-screen">
        <!-- –°–µ—Ç–∫–∞ –ª–æ—à–∞–¥–µ–π -->
        <div class="compact-horses-grid">
            {% for horse in horses %}
            <div class="compact-horse-card" onclick="selectHorse('{{ horse.id }}')">
                <div class="compact-horse-image-container">
                    {% if horse.image %}
                    <img src="{{ horse.image.url }}" 
                         alt="{{ horse.name }}" class="compact-horse-image">
                    {% else %}
                    <img src="{% static 'images/horse_default.jpg' %}" 
                         alt="{{ horse.name }}" class="compact-horse-image">
                    {% endif %}
                    
                    <div class="compact-availability-badge {% if horse.is_available %}compact-available{% else %}compact-busy{% endif %}">
                        {% if horse.is_available %}–î–æ—Å—Ç—É–ø–Ω–∞{% else %}–ó–∞–Ω—è—Ç–∞{% endif %}
                    </div>
                </div>
                
                <div class="compact-horse-content">
                    <h3 class="compact-horse-name">{{ horse.name }}</h3>
                    <div class="compact-horse-breed">{{ horse.get_breed_display }}</div>
                    <p class="compact-horse-description">{{ horse.description|truncatechars:150 }}</p>
                    
                    <div class="compact-price-info">
                        <div class="compact-price-with-discount">
                            <span class="compact-original-price">{{ horse.base_price_hour }} ‚ÇΩ/—á–∞—Å</span>
                            <span class="compact-discounted-price">{{ horse.premium_price_hour }} ‚ÇΩ/—á–∞—Å</span>
                            <span class="compact-subscription-benefit">-15%</span>
                        </div>

                        <div class="compact-horse-subscription-info">
                            ‚ö° –î–ª—è –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤ Pro: <strong>{{ horse.pro_price_hour }} ‚ÇΩ/—á–∞—Å</strong> 
                            <span class="compact-subscription-benefit">-25%</span>
                        </div>
                    </div>

                    {% if horse.is_available %}
                        {% if user.is_authenticated %}
                        <button class="compact-btn-book" onclick="selectHorseForBooking('{{ horse.id }}', event)">
                            –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å
                        </button>
                        {% else %}
                        <button class="compact-btn-book auth-required" onclick="showAuthModal()">
                            –í–æ–π—Ç–∏ –¥–ª—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
                        </button>
                        {% endif %}
                    {% else %}
                        <button class="compact-btn-book" disabled>
                            –ù–µ–¥–æ—Å—Ç—É–ø–Ω–∞
                        </button>
                    {% endif %}
                </div>
            </div>
            {% empty %}
            <div class="empty-state">
                <h3>–õ–æ—à–∞–¥–∏ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã</h3>
                <p>–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–≥–ª—è–Ω–∏—Ç–µ –ø–æ–∑–∂–µ –∏–ª–∏ —Å–≤—è–∂–∏—Ç–µ—Å—å —Å –Ω–∞–º–∏</p>
                <a href="tel:+79038917847" class="btn-contact">–ü–æ–∑–≤–æ–Ω–∏—Ç—å –º–µ–Ω–µ–¥–∂–µ—Ä—É</a>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω –≤—ã–±–æ—Ä–∞ –¥–∞—Ç—ã –∏ –≤—Ä–µ–º–µ–Ω–∏ -->
    <div id="date-time-screen" class="booking-screens-container">
        <div class="horse-details-screen">
            <div class="horse-details-header">
                <div class="horse-details-image">
                    <img id="detail-horse-image" src="" alt="–õ–æ—à–∞–¥—å">
                </div>
                <div class="horse-details-info">
                    <h2 id="detail-horse-name">–ò–º—è –ª–æ—à–∞–¥–∏</h2>
                    <div class="horse-details-breed" id="detail-horse-breed">–ü–æ—Ä–æ–¥–∞</div>
                    <p id="detail-horse-description">–û–ø–∏—Å–∞–Ω–∏–µ –ª–æ—à–∞–¥–∏</p>
                    
                    <div class="horse-characteristics">
                        <div class="characteristic-card">
                            <h4>–í–æ–∑—Ä–∞—Å—Ç</h4>
                            <p id="detail-horse-age">‚Äî</p>
                        </div>
                        <div class="characteristic-card">
                            <h4>–ú–∞—Å—Ç—å</h4>
                            <p id="detail-horse-color">‚Äî</p>
                        </div>
                        <div class="characteristic-card">
                            <h4>–£—Ä–æ–≤–µ–Ω—å</h4>
                            <p id="detail-horse-level">‚Äî</p>
                        </div>
                        <div class="characteristic-card">
                            <h4>–¶–µ–Ω–∞/—á–∞—Å</h4>
                            <p id="detail-horse-price">‚Äî ‚ÇΩ</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –ö–∞–ª–µ–Ω–¥–∞—Ä—å –¥–ª—è –≤—ã–±–æ—Ä–∞ –¥–∞—Ç—ã -->
            <div class="calendar-section">
                <h3 style="color: #2d5016; margin-bottom: 1.5rem; font-size: 1.4rem;">–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</h3>
                
                <div class="calendar-header">
                    <div class="calendar-nav">
                        <button class="calendar-nav-btn" onclick="changeMonth(-1)">
                            ‚Üê –ù–∞–∑–∞–¥
                        </button>
                        <h4 class="calendar-title" id="current-month">–î–µ–∫–∞–±—Ä—å 2024</h4>
                        <button class="calendar-nav-btn" onclick="changeMonth(1)">
                            –í–ø–µ—Ä–µ–¥ ‚Üí
                        </button>
                    </div>
                </div>
                
                <div class="calendar-grid" id="calendar-days">
                    <!-- –ö–∞–ª–µ–Ω–¥–∞—Ä—å –±—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω JavaScript -->
                </div>
                
                <div id="selected-date-info" style="margin: 1.5rem 0; padding: 1.5rem; background: rgba(139, 195, 74, 0.1); border-radius: 1rem; display: none; border: 2px solid #8bc34a;">
                    <strong style="color: #2d5016; font-size: 1.1rem;">–í—ã–±—Ä–∞–Ω–∞ –¥–∞—Ç–∞: </strong>
                    <span id="selected-date-text" style="font-weight: 600; color: #2d5016;"></span>
                </div>

                <!-- –í—ã–±–æ—Ä –≤—Ä–µ–º–µ–Ω–∏ -->
                <h3 style="color: #2d5016; margin: 2rem 0 1rem 0; font-size: 1.4rem;">–í—ã–±–µ—Ä–∏—Ç–µ –≤—Ä–µ–º—è</h3>
                <div class="time-slots" id="time-slots">
                    <!-- –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–ª–æ—Ç—ã –±—É–¥—É—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã JavaScript -->
                </div>
                
                <div id="selected-time-info" style="margin: 1.5rem 0; padding: 1.5rem; background: rgba(255, 193, 7, 0.1); border-radius: 1rem; display: none; border: 2px solid #ffc107;">
                    <strong style="color: #5d4037; font-size: 1.1rem;">–í—ã–±—Ä–∞–Ω–æ –≤—Ä–µ–º—è: </strong>
                    <span id="selected-time-text" style="font-weight: 600; color: #5d4037;"></span>
                </div>
            </div>

            <div class="navigation-controls">
                <button class="btn btn-secondary" onclick="backToHorses()">
                    ‚Üê –ù–∞–∑–∞–¥ –∫ –≤—ã–±–æ—Ä—É –ª–æ—à–∞–¥–∏
                </button>
                <button class="btn btn-primary" id="continue-to-booking" onclick="continueToBooking()" disabled>
                    –ü–µ—Ä–µ–π—Ç–∏ –∫ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—é
                </button>
            </div>
        </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è -->
    <div id="booking-screen" class="booking-screens-container">
        <div class="booking-form-container">
            <div class="booking-summary-card">
                <h3>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</h3>
                <div class="summary-row">
                    <span class="summary-label">–õ–æ—à–∞–¥—å:</span>
                    <span class="summary-value" id="summary-horse-name">‚Äî</span>
                </div>
                <div class="summary-row">
                    <span class="summary-label">–ü–æ—Ä–æ–¥–∞:</span>
                    <span class="summary-value" id="summary-horse-breed">‚Äî</span>
                </div>
                <div class="summary-row">
                    <span class="summary-label">–î–∞—Ç–∞:</span>
                    <span class="summary-value" id="summary-date">‚Äî</span>
                </div>
                <div class="summary-row">
                    <span class="summary-label">–í—Ä–µ–º—è:</span>
                    <span class="summary-value" id="summary-time">‚Äî</span>
                </div>
                <div class="summary-row">
                    <span class="summary-label">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:</span>
                    <span class="summary-value">1 —á–∞—Å</span>
                </div>
                <div class="summary-row">
                    <span class="summary-label">–¶–µ–Ω–∞/—á–∞—Å:</span>
                    <span class="summary-value" id="summary-price-hour">‚Äî ‚ÇΩ</span>
                </div>
                <div class="summary-row">
                    <span class="summary-label">–ò—Ç–æ–≥–æ:</span>
                    <span class="summary-value summary-total" id="summary-total-price">‚Äî ‚ÇΩ</span>
                </div>
            </div>

            <div class="booking-form">
                <h3 style="color: #2d5016; margin-bottom: 1.5rem; font-size: 1.3rem;">–ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
                
                <div class="form-group">
                    <label for="client-name">–í–∞—à–µ –∏–º—è *</label>
                    <input type="text" id="client-name" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –ø–æ–ª–Ω–æ–µ –∏–º—è" required>
                </div>

                <div class="form-group">
                    <label for="client-phone">–ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω *</label>
                    <div class="phone-input-container">
                        <span class="phone-prefix">+7</span>
                        <input type="tel" id="client-phone" class="phone-input" 
                               placeholder="(999) 999-99-99" 
                               required 
                               pattern="^\+7\s\(\d{3}\)\s\d{3}-\d{2}-\d{2}$"
                               title="–§–æ—Ä–º–∞—Ç: +7 (999) 999-99-99"
                               inputmode="numeric">
                    </div>
                    <span class="phone-hint">–í–≤–µ–¥–∏—Ç–µ 10 —Ü–∏—Ñ—Ä –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –ø–æ—Å–ª–µ +7</span>
                    <div class="validation-error" id="phone-error">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</div>
                    <div class="validation-success" id="phone-success">‚úì –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω</div>
                </div>

                <div class="form-group">
                    <label for="client-comment">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                    <textarea id="client-comment" rows="3" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –Ω—É–∂–Ω–∞ –ø–æ–º–æ—â—å —Ç—Ä–µ–Ω–µ—Ä–∞, –æ—Å–æ–±—ã–µ –ø–æ–∂–µ–ª–∞–Ω–∏—è..."></textarea>
                </div>

                <!-- –£–ª—É—á—à–µ–Ω–Ω—ã–π —á–µ–∫–±–æ–∫—Å —Å–æ–≥–ª–∞—Å–∏—è -->
                <div class="terms-checkbox" onclick="toggleTermsCheckbox()">
                    <input type="checkbox" id="agree-terms" required>
                    <label for="agree-terms">
                        –Ø —Å–æ–≥–ª–∞—Å–µ–Ω —Å 
                        <a href="#" class="terms-link" onclick="showTermsModal(event)">–ø—Ä–∞–≤–∏–ª–∞–º–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —É—Å–ª–æ–≤–∏—è–º–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</a>
                    </label>
                </div>

                <div class="navigation-controls">
                    <button class="btn btn-secondary" onclick="backToDateTime()">
                        ‚Üê –ù–∞–∑–∞–¥ –∫ –≤—ã–±–æ—Ä—É –≤—Ä–µ–º–µ–Ω–∏
                    </button>
                    <button class="btn btn-primary" id="submit-booking" onclick="submitBooking()">
                        –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è -->
    <div id="confirmation-screen" class="booking-screens-container">
        <div class="confirmation-screen">
            <div class="success-icon">‚úÖ</div>
            <h2 class="confirmation-title">–ë—Ä–æ–Ω—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞!</h2>
            <div class="booking-status status-confirmed">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ</div>
            <div class="booking-number" id="booking-number">‚Ññ BK-2024-0001</div>
            
            <div class="booking-summary-card" style="margin: 2rem auto; max-width: 500px;">
                <div class="summary-row">
                    <span class="summary-label">–õ–æ—à–∞–¥—å:</span>
                    <span class="summary-value" id="confirm-horse-name">‚Äî</span>
                </div>
                <div class="summary-row">
                    <span class="summary-label">–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è:</span>
                    <span class="summary-value" id="confirm-datetime">‚Äî</span>
                </div>
                <div class="summary-row">
                    <span class="summary-label">–°—Ç–æ–∏–º–æ—Å—Ç—å:</span>
                    <span class="summary-value" id="confirm-price">‚Äî</span>
                </div>
                <div class="summary-row">
                    <span class="summary-label">–ö–ª–∏–µ–Ω—Ç:</span>
                    <span class="summary-value" id="confirm-client-name">‚Äî</span>
                </div>
                <div class="summary-row">
                    <span class="summary-label">–¢–µ–ª–µ—Ñ–æ–Ω:</span>
                    <span class="summary-value" id="confirm-client-phone">‚Äî</span>
                </div>
            </div>

            <div class="navigation-controls" style="max-width: 500px; margin: 2rem auto;">
                <button class="btn btn-primary" onclick="backToHorses()">
                    üêé –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –µ—â–µ
                </button>
                <button class="btn btn-secondary" onclick="contactManager()">
                    üìû –°–≤—è–∑–∞—Ç—å—Å—è —Å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º
                </button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞–º–∏ –ø–æ–¥–ø–∏—Å–∫–∏ -->
    <div class="modal-overlay" id="subscriptionModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeSubscriptionModal()">√ó</button>
            <div class="modal-header">
                <h2 class="modal-title">–ü—Ä–µ–º–∏—É–º –ø–æ–¥–ø–∏—Å–∫–∞ "–ö–æ–Ω–Ω–∏–∫"</h2>
                <p class="modal-subtitle">–ü–æ–ª—É—á–∏—Ç–µ –¥–æ—Å—Ç—É–ø –∫ —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–º –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞–º –∏ —Å–∫–∏–¥–∫–∞–º!</p>
            </div>
            <div class="modal-body">
                <ul style="list-style: none; padding: 0; margin-bottom: 2rem;">
                    <li style="padding: 0.8rem 0; border-bottom: 1px solid #f0f0f0; display: flex; align-items: center; gap: 0.8rem; font-size: 1rem;">
                        <span style="color: #4caf50; font-weight: bold; font-size: 1.2rem;">‚úì</span>
                        <span>–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–æ–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ—à–∞–¥–µ–π</span>
                    </li>
                    <li style="padding: 0.8rem 0; border-bottom: 1px solid #f0f0f0; display: flex; align-items: center; gap: 0.8rem; font-size: 1rem;">
                        <span style="color: #4caf50; font-weight: bold; font-size: 1.2rem;">‚úì</span>
                        <span>–°–∫–∏–¥–∫–∞ 15% –Ω–∞ –≤—Å–µ —É—Å–ª—É–≥–∏</span>
                    </li>
                    <li style="padding: 0.8rem 0; border-bottom: 1px solid #f0f0f0; display: flex; align-items: center; gap: 0.8rem; font-size: 1rem;">
                        <span style="color: #4caf50; font-weight: bold; font-size: 1.2rem;">‚úì</span>
                        <span>–ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ –∫–æ—Ä–º–æ–≤ –æ—Ç 2000 ‚ÇΩ</span>
                    </li>
                    <li style="padding: 0.8rem 0; border-bottom: 1px solid #f0f0f0; display: flex; align-items: center; gap: 0.8rem; font-size: 1rem;">
                        <span style="color: #4caf50; font-weight: bold; font-size: 1.2rem;">‚úì</span>
                        <span>–î–æ—Å—Ç—É–ø –∫ –∑–∞–∫—Ä—ã—Ç—ã–º –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è–º</span>
                    </li>
                    <li style="padding: 0.8rem 0; display: flex; align-items: center; gap: 0.8rem; font-size: 1rem;">
                        <span style="color: #4caf50; font-weight: bold; font-size: 1.2rem;">‚úì</span>
                        <span>–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç —Å –∏—Å—Ç–æ—Ä–∏–µ–π –∑–∞–∫–∞–∑–æ–≤</span>
                    </li>
                </ul>

                <div style="display: flex; align-items: center; gap: 1rem; justify-content: center; margin-bottom: 2rem;">
                    <span style="text-decoration: line-through; color: #999; font-size: 1.2rem; font-weight: 500;">1 165 ‚ÇΩ</span>
                    <span style="color: #4caf50; font-weight: 800; font-size: 1.5rem;">990 ‚ÇΩ/–º–µ—Å—è—Ü</span>
                    <span style="background: linear-gradient(135deg, #4caf50, #8bc34a); color: white; padding: 0.4rem 0.8rem; border-radius: 2rem; font-size: 0.9rem; font-weight: 700; box-shadow: 0 2px 5px rgba(76, 175, 80, 0.3);">
                        -15%
                    </span>
                </div>

                <div style="display: flex; gap: 1rem; justify-content: center;">
                    <button style="background: linear-gradient(135deg, #4caf50, #2e7d32); color: white; border: none; padding: 1rem 2rem; border-radius: 2rem; font-weight: 700; cursor: pointer; transition: all 0.3s ease; font-size: 1rem; box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);"
                            onclick="subscribeNow()">
                        –û—Ñ–æ—Ä–º–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É
                    </button>
                    <button style="background: transparent; color: #4caf50; border: 2px solid #4caf50; padding: 1rem 2rem; border-radius: 2rem; font-weight: 700; cursor: pointer; transition: all 0.3s ease; font-size: 1rem;"
                            onclick="closeSubscriptionModal()">
                        –ü–æ–∑–∂–µ
                    </button>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block extra_js %}
<script>
    // ======================
    // –ü–ï–†–ï–ú–ï–ù–ù–´–ï –ò –ö–û–ù–°–¢–ê–ù–¢–´
    // ======================
    let selectedHorse = null;
    let selectedDate = null;
    let selectedTime = null;
    let userSubscription = null;
    let currentMonth = new Date().getMonth();
    let currentYear = new Date().getFullYear();
    
    // –î–∞–Ω–Ω—ã–µ –ª–æ—à–∞–¥–µ–π –∏–∑ Django
    const horsesData = {
        {% for horse in horses %}
        '{{ horse.id }}': {
            id: '{{ horse.id }}',
            name: '{{ horse.name }}',
            breed: '{{ horse.get_breed_display }}',
            description: '{{ horse.description }}',
            age: {{ horse.age }},
            color: '{{ horse.color }}',
            level: '{{ horse.get_level_display }}',
            is_available: {{ horse.is_available|lower }},
            base_price_hour: parseFloat('{{ horse.base_price_hour }}'),
            premium_price_hour: parseFloat('{{ horse.premium_price_hour }}'),
            pro_price_hour: parseFloat('{{ horse.pro_price_hour }}'),
            image: '{% if horse.image %}{{ horse.image.url }}{% else %}{% static "images/horse_default.jpg" %}{% endif %}'
        },
        {% endfor %}
    };

    // ======================
    // –§–£–ù–ö–¶–ò–ò –£–ü–†–ê–í–õ–ï–ù–ò–Ø –≠–ö–†–ê–ù–ê–ú–ò
    // ======================
    function showScreen(screenId) {
        // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —ç–∫—Ä–∞–Ω—ã
        document.getElementById('main-screen').style.display = 'none';
        document.getElementById('date-time-screen').classList.remove('active');
        document.getElementById('booking-screen').classList.remove('active');
        document.getElementById('confirmation-screen').classList.remove('active');
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—ã–π —ç–∫—Ä–∞–Ω
        if (screenId === 'main') {
            document.getElementById('main-screen').style.display = 'block';
        } else {
            document.getElementById(screenId + '-screen').classList.add('active');
        }
        
        // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –Ω–∞–≤–µ—Ä—Ö
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function backToHorses() {
        selectedHorse = null;
        selectedDate = null;
        selectedTime = null;
        showScreen('main');
    }

    function backToDateTime() {
        showScreen('date-time');
    }

    // ======================
    // –§–£–ù–ö–¶–ò–ò –î–õ–Ø –†–ê–ë–û–¢–´ –° –õ–û–®–ê–î–¨–ú–ò
    // ======================
    function selectHorseForBooking(horseId, event) {
        if (event) event.stopPropagation();
        
        if (!horsesData[horseId]) return;
        
        const horse = horsesData[horseId];
        
        if (!horse.is_available) {
            showNotification('–≠—Ç–∞ –ª–æ—à–∞–¥—å –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –¥–ª—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –¥—Ä—É–≥—É—é.', 'error');
            return;
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
        {% if not user.is_authenticated %}
        showAuthModal();
        return;
        {% endif %}
        
        selectedHorse = horse;
        updateHorseDetails();
        updateCalendar();
        updateTimeSlots();
        showScreen('date-time');
    }

    function updateHorseDetails() {
        if (!selectedHorse) return;
        
        const horse = selectedHorse;
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
        document.getElementById('detail-horse-image').src = horse.image;
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
        document.getElementById('detail-horse-name').textContent = horse.name;
        document.getElementById('detail-horse-breed').textContent = horse.breed;
        document.getElementById('detail-horse-description').textContent = horse.description;
        document.getElementById('detail-horse-age').textContent = horse.age + ' –ª–µ—Ç';
        document.getElementById('detail-horse-color').textContent = horse.color;
        document.getElementById('detail-horse-level').textContent = horse.level;
        
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ü–µ–Ω—É –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø–æ–¥–ø–∏—Å–∫–∏
        let price = horse.base_price_hour;
        if (userSubscription === 'premium') {
            price = horse.premium_price_hour;
        } else if (userSubscription === 'pro') {
            price = horse.pro_price_hour;
        }
        
        document.getElementById('detail-horse-price').textContent = price + ' ‚ÇΩ';
    }

    // ======================
    // –ö–ê–õ–ï–ù–î–ê–†–¨ –ò –í–´–ë–û–† –î–ê–¢–´
    // ======================
    function updateCalendar() {
        const calendarGrid = document.getElementById('calendar-days');
        if (!calendarGrid) return;
        
        // –û—á–∏—â–∞–µ–º –∫–∞–ª–µ–Ω–¥–∞—Ä—å
        calendarGrid.innerHTML = '';
        
        // –ù–∞–∑–≤–∞–Ω–∏—è –¥–Ω–µ–π –Ω–µ–¥–µ–ª–∏
        const daysOfWeek = ['–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±', '–í—Å'];
        
        // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏ –¥–Ω–µ–π –Ω–µ–¥–µ–ª–∏
        daysOfWeek.forEach(day => {
            const dayElement = document.createElement('div');
            dayElement.className = 'calendar-day';
            dayElement.textContent = day;
            calendarGrid.appendChild(dayElement);
        });
        
        // –ü–æ–ª—É—á–∞–µ–º –ø–µ—Ä–≤—ã–π –¥–µ–Ω—å –º–µ—Å—è—Ü–∞
        const firstDay = new Date(currentYear, currentMonth, 1);
        const lastDay = new Date(currentYear, currentMonth + 1, 0);
        
        // –ü–æ–ª—É—á–∞–µ–º –¥–µ–Ω—å –Ω–µ–¥–µ–ª–∏ –ø–µ—Ä–≤–æ–≥–æ –¥–Ω—è (0 - –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ, 1 - –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫, –∏ —Ç.–¥.)
        let firstDayIndex = firstDay.getDay();
        if (firstDayIndex === 0) firstDayIndex = 7; // –í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è 7-–º –¥–Ω–µ–º
        
        // –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Å—Ç—ã–µ —è—á–µ–π–∫–∏ –¥–ª—è –¥–Ω–µ–π –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞
        for (let i = 1; i < firstDayIndex; i++) {
            const emptyCell = document.createElement('div');
            emptyCell.className = 'calendar-date other-month';
            calendarGrid.appendChild(emptyCell);
        }
        
        // –î–æ–±–∞–≤–ª—è–µ–º –¥–Ω–∏ —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        
        for (let day = 1; day <= lastDay.getDate(); day++) {
            const date = new Date(currentYear, currentMonth, day);
            const dateElement = document.createElement('div');
            dateElement.className = 'calendar-date';
            dateElement.textContent = day;
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –¥–∞—Ç—ã
            if (date < today) {
                dateElement.classList.add('past');
            } else {
                // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –¥–∞—Ç—ã
                const isAvailable = Math.random() > 0.2; // 80% –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –¥–∞—Ç –¥–ª—è –¥–µ–º–æ
                dateElement.classList.add(isAvailable ? 'available' : 'unavailable');
                
                if (isAvailable && !dateElement.classList.contains('past')) {
                    dateElement.onclick = function() {
                        selectDate(date, dateElement);
                    };
                }
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–µ–≥–æ–¥–Ω—è—à–Ω–∏–π –¥–µ–Ω—å
            if (date.toDateString() === today.toDateString()) {
                dateElement.classList.add('today');
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –¥–∞—Ç—É
            if (selectedDate && selectedDate.toDateString() === date.toDateString()) {
                dateElement.classList.add('selected');
            }
            
            calendarGrid.appendChild(dateElement);
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –º–µ—Å—è—Ü–∞
        const monthNames = [
            '–Ø–Ω–≤–∞—Ä—å', '–§–µ–≤—Ä–∞–ª—å', '–ú–∞—Ä—Ç', '–ê–ø—Ä–µ–ª—å', '–ú–∞–π', '–ò—é–Ω—å',
            '–ò—é–ª—å', '–ê–≤–≥—É—Å—Ç', '–°–µ–Ω—Ç—è–±—Ä—å', '–û–∫—Ç—è–±—Ä—å', '–ù–æ—è–±—Ä—å', '–î–µ–∫–∞–±—Ä—å'
        ];
        document.getElementById('current-month').textContent = 
            `${monthNames[currentMonth]} ${currentYear}`;
    }

    function changeMonth(delta) {
        currentMonth += delta;
        
        if (currentMonth < 0) {
            currentMonth = 11;
            currentYear--;
        } else if (currentMonth > 11) {
            currentMonth = 0;
            currentYear++;
        }
        
        updateCalendar();
        updateTimeSlots();
    }

    function selectDate(date, element) {
        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å–æ –≤—Å–µ—Ö –¥–∞—Ç
        document.querySelectorAll('.calendar-date').forEach(dateEl => {
            dateEl.classList.remove('selected');
        });
        
        // –í—ã–¥–µ–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –¥–∞—Ç—É
        element.classList.add('selected');
        selectedDate = date;
        selectedTime = null;
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –¥–∞—Ç—ã
        const monthNames = [
            '—è–Ω–≤–∞—Ä—è', '—Ñ–µ–≤—Ä–∞–ª—è', '–º–∞—Ä—Ç–∞', '–∞–ø—Ä–µ–ª—è', '–º–∞—è', '–∏—é–Ω—è',
            '–∏—é–ª—è', '–∞–≤–≥—É—Å—Ç–∞', '—Å–µ–Ω—Ç—è–±—Ä—è', '–æ–∫—Ç—è–±—Ä—è', '–Ω–æ—è–±—Ä—è', '–¥–µ–∫–∞–±—Ä—è'
        ];
        
        const day = date.getDate();
        const month = monthNames[date.getMonth()];
        const year = date.getFullYear();
        const dayOfWeek = ['–≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ', '–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫', '–≤—Ç–æ—Ä–Ω–∏–∫', '—Å—Ä–µ–¥–∞', '—á–µ—Ç–≤–µ—Ä–≥', '–ø—è—Ç–Ω–∏—Ü–∞', '—Å—É–±–±–æ—Ç–∞'][date.getDay()];
        
        document.getElementById('selected-date-text').textContent = 
            `${day} ${month} ${year} (${dayOfWeek})`;
        document.getElementById('selected-date-info').style.display = 'block';
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–ª–æ—Ç—ã
        updateTimeSlots();
        
        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–±–æ—Ä –≤—Ä–µ–º–µ–Ω–∏
        document.getElementById('selected-time-info').style.display = 'none';
        document.querySelectorAll('.time-slot').forEach(slot => {
            slot.classList.remove('selected');
        });
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è
        checkContinueButton();
    }

    // ======================
    // –í–´–ë–û–† –í–†–ï–ú–ï–ù–ò
    // ======================
    function updateTimeSlots() {
        const timeSlotsContainer = document.getElementById('time-slots');
        if (!timeSlotsContainer) return;
        
        timeSlotsContainer.innerHTML = '';
        
        if (!selectedDate) {
            return;
        }
        
        // –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–ª–æ—Ç—ã (–¥–ª—è –¥–µ–º–æ)
        const timeSlots = [
            '09:00 - 10:00',
            '10:00 - 11:00', 
            '11:00 - 12:00',
            '13:00 - 14:00',
            '14:00 - 15:00',
            '15:00 - 16:00',
            '16:00 - 17:00',
            '17:00 - 18:00'
        ];
        
        timeSlots.forEach(slot => {
            const slotElement = document.createElement('div');
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–ª–æ—Ç–∞
            const isAvailable = Math.random() > 0.3; // 70% –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤ –¥–ª—è –¥–µ–º–æ
            
            slotElement.className = `time-slot ${isAvailable ? 'available' : 'unavailable'}`;
            slotElement.textContent = slot;
            
            if (isAvailable) {
                slotElement.onclick = function() {
                    selectTimeSlot(slot, slotElement);
                };
            }
            
            timeSlotsContainer.appendChild(slotElement);
        });
    }

    function selectTimeSlot(time, element) {
        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å–æ –≤—Å–µ—Ö —Å–ª–æ—Ç–æ–≤
        document.querySelectorAll('.time-slot').forEach(slot => {
            slot.classList.remove('selected');
        });
        
        // –í—ã–¥–µ–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Å–ª–æ—Ç
        element.classList.add('selected');
        selectedTime = time;
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
        document.getElementById('selected-time-text').textContent = time;
        document.getElementById('selected-time-info').style.display = 'block';
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è
        checkContinueButton();
    }

    function checkContinueButton() {
        const continueBtn = document.getElementById('continue-to-booking');
        if (selectedDate && selectedTime) {
            continueBtn.disabled = false;
            continueBtn.style.opacity = '1';
            continueBtn.style.cursor = 'pointer';
        } else {
            continueBtn.disabled = true;
            continueBtn.style.opacity = '0.6';
            continueBtn.style.cursor = 'not-allowed';
        }
    }

    function continueToBooking() {
        if (!selectedDate || !selectedTime) {
            showNotification('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è', 'warning');
            return;
        }
        
        updateBookingSummary();
        showScreen('booking');
    }

    // ======================
    // –û–ë–ù–û–í–õ–ï–ù–ò–ï –°–í–û–î–ö–ò –ë–†–û–ù–ò–†–û–í–ê–ù–ò–Ø
    // ======================
    function updateBookingSummary() {
        if (!selectedHorse || !selectedDate || !selectedTime) return;
        
        const horse = selectedHorse;
        
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ü–µ–Ω—É –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø–æ–¥–ø–∏—Å–∫–∏
        let price = horse.base_price_hour;
        if (userSubscription === 'premium') {
            price = horse.premium_price_hour;
        } else if (userSubscription === 'pro') {
            price = horse.pro_price_hour;
        }
        
        // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–∞—Ç—É
        const dateStr = selectedDate.toLocaleDateString('ru-RU', {
            weekday: 'long',
            day: 'numeric',
            month: 'long',
            year: 'numeric'
        });
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
        document.getElementById('summary-horse-name').textContent = horse.name;
        document.getElementById('summary-horse-breed').textContent = horse.breed;
        document.getElementById('summary-date').textContent = dateStr;
        document.getElementById('summary-time').textContent = selectedTime;
        document.getElementById('summary-price-hour').textContent = price + ' ‚ÇΩ';
        document.getElementById('summary-total-price').textContent = price + ' ‚ÇΩ';
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
        document.getElementById('confirm-horse-name').textContent = horse.name;
        document.getElementById('confirm-datetime').textContent = dateStr + ', ' + selectedTime;
        document.getElementById('confirm-price').textContent = price + ' ‚ÇΩ';
    }

    // ======================
    // –§–û–†–ú–ê–¢–ò–†–û–í–ê–ù–ò–ï –¢–ï–õ–ï–§–û–ù–ê
    // ======================
    function formatPhoneNumber(value) {
        // –£–±–∏—Ä–∞–µ–º –≤—Å–µ –∫—Ä–æ–º–µ —Ü–∏—Ñ—Ä
        let numbers = value.replace(/\D/g, '');
        
        // –ï—Å–ª–∏ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å 7 –∏–ª–∏ 8
        if (numbers.startsWith('7') || numbers.startsWith('8')) {
            numbers = '7' + numbers.substring(1);
        } else if (numbers.startsWith('9')) {
            numbers = '7' + numbers;
        }
        
        // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –ø–æ —à–∞–±–ª–æ–Ω—É +7 (XXX) XXX-XX-XX
        let formatted = '+7';
        
        if (numbers.length > 1) {
            formatted += ' (' + numbers.substring(1, 4);
        }
        if (numbers.length >= 4) {
            formatted += ') ' + numbers.substring(4, 7);
        }
        if (numbers.length >= 7) {
            formatted += '-' + numbers.substring(7, 9);
        }
        if (numbers.length >= 9) {
            formatted += '-' + numbers.substring(9, 11);
        }
        
        return formatted;
    }

    function validatePhoneNumber(phone) {
        // –£–±–∏—Ä–∞–µ–º –≤—Å–µ –∫—Ä–æ–º–µ —Ü–∏—Ñ—Ä
        const numbers = phone.replace(/\D/g, '');
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–æ—Å—Å–∏–π—Å–∫–∏–π –Ω–æ–º–µ—Ä: 7XXXXXXXXXX
        return numbers.length === 11 && numbers.startsWith('7');
    }

    // ======================
    // –ß–ï–ö–ë–û–ö–° –°–û–ì–õ–ê–°–ò–Ø
    // ======================
    function toggleTermsCheckbox() {
        const checkbox = document.getElementById('agree-terms');
        checkbox.checked = !checkbox.checked;
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∏–ª–∏
        const container = document.querySelector('.terms-checkbox');
        if (checkbox.checked) {
            container.style.borderColor = '#4caf50';
            container.style.background = '#f1f8e9';
        } else {
            container.style.borderColor = '#e0e0e0';
            container.style.background = '#f9f9f9';
        }
    }

    function showTermsModal(event) {
        event.preventDefault();
        event.stopPropagation();
        
        alert('–ü—Ä–∞–≤–∏–ª–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —É—Å–ª–æ–≤–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:\n\n1. –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ —Å–∞–π—Ç\n2. –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è - 1 —á–∞—Å\n3. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ—Å–ª–µ –ø—Ä–µ–¥–æ–ø–ª–∞—Ç—ã\n4. –í–æ–∑–≤—Ä–∞—Ç –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ –∑–∞ 48 —á–∞—Å–æ–≤\n5. –°–æ–±–ª—é–¥–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ');
    }

    // ======================
    // –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–ï –ë–†–û–ù–ò–†–û–í–ê–ù–ò–Ø
    // ======================
    function submitBooking() {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
        const nameInput = document.getElementById('client-name');
        const phoneInput = document.getElementById('client-phone');
        const termsCheckbox = document.getElementById('agree-terms');
        
        let isValid = true;
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–º–µ–Ω–∏
        if (!nameInput.value.trim()) {
            nameInput.classList.add('input-error');
            showNotification('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è', 'error');
            isValid = false;
        } else {
            nameInput.classList.remove('input-error');
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
        if (!validatePhoneNumber(phoneInput.value)) {
            phoneInput.classList.add('input-error');
            document.getElementById('phone-error').style.display = 'block';
            document.getElementById('phone-success').style.display = 'none';
            showNotification('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞', 'error');
            isValid = false;
        } else {
            phoneInput.classList.remove('input-error');
            phoneInput.classList.add('input-success');
            document.getElementById('phone-error').style.display = 'none';
            document.getElementById('phone-success').style.display = 'block';
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≥–ª–∞—Å–∏—è —Å –ø—Ä–∞–≤–∏–ª–∞–º–∏
        if (!termsCheckbox.checked) {
            showNotification('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–æ–≥–ª–∞—Å–∏—Ç–µ—Å—å —Å –ø—Ä–∞–≤–∏–ª–∞–º–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è', 'error');
            isValid = false;
        }
        
        if (!isValid) {
            return;
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–ª–∏–µ–Ω—Ç–µ
        document.getElementById('confirm-client-name').textContent = nameInput.value.trim();
        document.getElementById('confirm-client-phone').textContent = phoneInput.value;
        
        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–æ–º–µ—Ä –±—Ä–æ–Ω–∏
        const bookingNumber = 'BK-' + new Date().getFullYear() + '-' + 
            Math.floor(1000 + Math.random() * 9000);
        document.getElementById('booking-number').textContent = '‚Ññ ' + bookingNumber;
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∑–∞—è–≤–∫—É
        saveBooking({
            horse: selectedHorse.name,
            horseId: selectedHorse.id,
            date: selectedDate.toISOString(),
            time: selectedTime,
            clientName: nameInput.value.trim(),
            clientPhone: phoneInput.value,
            comment: document.getElementById('client-comment').value,
            price: selectedHorse.base_price_hour,
            bookingNumber: bookingNumber
        });
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
        showScreen('confirmation');
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        showNotification('–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ!', 'success');
    }

    function saveBooking(bookingData) {
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
        let bookings = JSON.parse(localStorage.getItem('horse_bookings')) || [];
        bookings.push(bookingData);
        localStorage.setItem('horse_bookings', JSON.stringify(bookings));
        
        // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
        console.log('Booking saved:', bookingData);
    }

    // ======================
    // –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê
    // ======================
    function showSubscriptionModal() {
        document.getElementById('subscriptionModal').classList.add('active');
    }

    function closeSubscriptionModal() {
        document.getElementById('subscriptionModal').classList.remove('active');
    }

    function subscribeNow() {
        showNotification('–§—É–Ω–∫—Ü–∏—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∏ –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø–æ–∑–∂–µ', 'info');
        closeSubscriptionModal();
    }

    function showAuthModal() {
        alert('–î–ª—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –ª–æ—à–∞–¥–µ–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É');
        // window.location.href = '{% url "login" %}';
    }

    function contactManager() {
        window.location.href = 'tel:+79038917847';
    }

    // ======================
    // –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø
    // ======================
    function showNotification(message, type = 'info') {
        const colors = {
            success: '#4caf50',
            error: '#f44336',
            info: '#2196f3',
            warning: '#ff9800'
        };
        
        const notification = document.createElement('div');
        notification.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: ${colors[type]};
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 0.8rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            z-index: 2000;
            animation: slideInRight 0.3s ease;
            font-weight: 500;
            max-width: 350px;
            backdrop-filter: blur(10px);
            border-left: 4px solid rgba(255, 255, 255, 0.3);
        `;
        
        notification.textContent = message;
        document.body.appendChild(notification);
        
        setTimeout(() => {
            notification.style.animation = 'slideOutRight 0.3s ease';
            setTimeout(() => {
                document.body.removeChild(notification);
            }, 300);
        }, 4000);
        
        // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª–∏ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–π
        if (!document.getElementById('notification-styles')) {
            const style = document.createElement('style');
            style.id = 'notification-styles';
            style.textContent = `
                @keyframes slideInRight {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
                @keyframes slideOutRight {
                    from { transform: translateX(0); opacity: 1; }
                    to { transform: translateX(100%); opacity: 0; }
                }
            `;
            document.head.appendChild(style);
        }
    }

    // ======================
    // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
    // ======================
    document.addEventListener('DOMContentLoaded', function() {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–ø–∏—Å–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        userSubscription = localStorage.getItem('user_subscription');
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã
        const phoneInput = document.getElementById('client-phone');
        if (phoneInput) {
            phoneInput.addEventListener('input', function(e) {
                const cursorPosition = e.target.selectionStart;
                const oldValue = e.target.value;
                const formatted = formatPhoneNumber(oldValue);
                
                e.target.value = formatted;
                
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é –∫—É—Ä—Å–æ—Ä–∞
                const diff = formatted.length - oldValue.length;
                e.target.setSelectionRange(cursorPosition + diff, cursorPosition + diff);
            });
            
            phoneInput.addEventListener('keypress', function(e) {
                // –†–∞–∑—Ä–µ—à–∞–µ–º —Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã, backspace, delete, tab
                if (!/[0-9]/.test(e.key) && 
                    e.key !== 'Backspace' && 
                    e.key !== 'Delete' && 
                    e.key !== 'Tab') {
                    e.preventDefault();
                }
            });
        }
        
        // –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –∏–º–µ–Ω–∏, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
        {% if user.is_authenticated %}
        const nameInput = document.getElementById('client-name');
        if (nameInput) {
            nameInput.value = '{{ user.first_name }} {{ user.last_name }}'.trim() || '{{ user.username }}';
        }
        {% endif %}
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–∞–ª–µ–Ω–¥–∞—Ä—å
        updateCalendar();
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω
        document.addEventListener('click', function(event) {
            if (event.target.classList.contains('modal-overlay')) {
                event.target.classList.remove('active');
            }
        });

        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                document.querySelectorAll('.modal-overlay.active').forEach(modal => {
                    modal.classList.remove('active');
                });
            }
        });
    });

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ –∫–∞—Ä—Ç–æ—á–∫–µ –ª–æ—à–∞–¥–∏
    function selectHorse(horseId) {
        const horse = horsesData[horseId];
        if (horse && horse.is_available) {
            selectHorseForBooking(horseId, {stopPropagation: function(){}});
        }
    }
    function calculatePriceForUser(horse) {
    let basePrice = parseFloat(horse.base_price_hour);
    let userPrice = basePrice;
    let discountPercent = 0;
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
    {% if user.is_authenticated %}
        // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∫–∏
        fetch('/profile/get-profile-data/')
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    if (data.user.subscription === 'premium' && data.user.subscription_active) {
                        userPrice = parseFloat(horse.premium_price_hour);
                        discountPercent = 15;
                    } else if (data.user.subscription === 'pro' && data.user.subscription_active) {
                        userPrice = parseFloat(horse.pro_price_hour);
                        discountPercent = 25;
                    }
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ü–µ–Ω—ã
                    updatePriceDisplay(userPrice, discountPercent, basePrice);
                }
            })
            .catch(error => {
                console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–¥–ø–∏—Å–∫–∏:', error);
            });
    {% endif %}
    
    return { userPrice, discountPercent, basePrice };
}
</script>
{% endblock %}