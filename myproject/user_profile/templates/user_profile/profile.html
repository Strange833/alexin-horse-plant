{% extends 'main/base.html' %}
{% load static %}

{% block title %}–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å - –ê–ª–µ–∫—Å–∏–Ω—Å–∫–∏–π –∫–æ–Ω–Ω—ã–π –∑–∞–≤–æ–¥{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/profile.css' %}">
{% endblock %}

{% block content %}
<div class="profile-page">
    <div class="profile-container">
        <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ -->
        <div class="profile-sidebar">
            <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
            <div class="user-card">
                <div class="user-avatar">
                    {% if user.profile.avatar %}
                        <img src="{{ user.profile.avatar.url }}" alt="–ê–≤–∞—Ç–∞—Ä" class="avatar-img">
                    {% else %}
                        <div class="avatar-placeholder">üë§</div>
                    {% endif %}
                </div>
                
                <h2 class="user-name">{{ user.username }}</h2>
                <p class="user-email">{{ user.email|default:"Email –Ω–µ —É–∫–∞–∑–∞–Ω" }}</p>
                
                <div class="user-details">
                    <div class="detail-item">
                        <span class="detail-icon">üë§</span>
                        <span id="profileFullName">{{ user.get_full_name|default:user.username }}</span>
                    </div>
                    
                    <div class="detail-item">
                        <span class="detail-icon">üì±</span>
                        <span id="profilePhone">{{ user.profile.phone|default:"–¢–µ–ª–µ—Ñ–æ–Ω –Ω–µ —É–∫–∞–∑–∞–Ω" }}</span>
                    </div>
                    
                    <div class="detail-item">
                        <span class="detail-icon">üìç</span>
                        <span id="profileAddress">{{ user.profile.address|default:"–ê–¥—Ä–µ—Å –Ω–µ —É–∫–∞–∑–∞–Ω"|truncatechars:30 }}</span>
                    </div>
                    
                    <div class="detail-item">
                        <span class="detail-icon">üìÖ</span>
                        <span>–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω: {{ user.date_joined|date:"d.m.Y" }}</span>
                    </div>
                </div>
                
                <!-- –ö–ù–û–ü–ö–ê –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–Ø –ü–†–û–§–ò–õ–Ø -->
                <button class="btn-edit-profile" id="editProfileBtn">
                    <span>‚úèÔ∏è</span> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
                </button>
            </div>
            
            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
            <div class="stats-card">
                <h3 class="stats-title">–í–∞—à–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                <div class="stats-grid">
                    <div class="stat-item">
                        <span class="stat-value" id="horsesCount">0</span>
                        <span class="stat-label">–õ–æ—à–∞–¥–µ–π</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="ordersCount">0</span>
                        <span class="stat-label">–ó–∞–∫–∞–∑–æ–≤</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="yearsCount">1</span>
                        <span class="stat-label">–õ–µ—Ç —Å –Ω–∞–º–∏</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="totalSpent">0 ‚ÇΩ</span>
                        <span class="stat-label">–í—Å–µ–≥–æ –ø–æ—Ç—Ä–∞—á–µ–Ω–æ</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="totalSavings">0 ‚ÇΩ</span>
                        <span class="stat-label">–í–∞—à–∞ —ç–∫–æ–Ω–æ–º–∏—è</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="userRating">4.8</span>
                        <span class="stat-label">–†–µ–π—Ç–∏–Ω–≥</span>
                    </div>
                </div>
            </div>
            
            <!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
            <div class="stats-card">
                <h3 class="stats-title">–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h3>
                <div class="quick-actions">
                    <button class="btn-upgrade premium" onclick="window.location.href='{% url 'food_list' %}'">
                        üõí –ú–∞–≥–∞–∑–∏–Ω –∫–æ—Ä–º–æ–≤
                    </button>
                    <button class="btn-upgrade pro" onclick="window.location.href='{% url 'cart' %}'">
                        üì¶ –ú–æ—è –∫–æ—Ä–∑–∏–Ω–∞
                    </button>
                    <button class="btn-cancel" id="logoutBtn">
                        üö™ –í—ã–π—Ç–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
                    </button>
                </div>
            </div>
        </div>
        
        <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ -->
        <div class="profile-content">
            <!-- –°–µ–∫—Ü–∏—è –ø–æ–¥–ø–∏—Å–∫–∏ -->
            <section class="profile-section subscription-section" id="subscription">
                <h2 class="section-title">
                    <span class="section-icon">üíé</span>
                    –í–∞—à–∞ –ø–æ–¥–ø–∏—Å–∫–∞
                </h2>
                <div id="subscriptionContainer">
                    <div class="subscription-card pro active">
                        <div class="subscription-header">
                            <span class="subscription-icon">üèÜ</span>
                            <h3>–°–ø–æ—Ä—Ç—Å–º–µ–Ω</h3>
                        </div>
                        <div class="subscription-status status-active">–ê–∫—Ç–∏–≤–Ω–∞</div>
                        <p><strong>–°—Ç–æ–∏–º–æ—Å—Ç—å:</strong> 1990‚ÇΩ/–º–µ—Å—è—Ü</p>
                        <p><strong>–í–∞—à–∏ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:</strong></p>
                        <ul class="subscription-features">
                            <li>–°–∫–∏–¥–∫–∞ 20% –Ω–∞ –≤—Å–µ –∫–æ—Ä–º–∞</li>
                            <li>–≠–∫—Å–ø—Ä–µ—Å—Å-–¥–æ—Å—Ç–∞–≤–∫–∞ 24/7</li>
                            <li>–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</li>
                            <li>–ù–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª–æ—à–∞–¥–µ–π</li>
                            <li>–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –≤–µ—Ç–µ—Ä–∏–Ω–∞—Ä–∞</li>
                            <li>–¢—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã</li>
                        </ul>
                        <div class="subscription-actions">
                            <button class="btn-upgrade free" onclick="changeSubscription('free')">
                                ‚≠ê –õ—é–±–∏—Ç–µ–ª—å
                            </button>
                            <button class="btn-upgrade premium" onclick="changeSubscription('premium')">
                                üíé –ö–æ–Ω–Ω–∏–∫
                            </button>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- –°–µ–∫—Ü–∏—è –ª–æ—à–∞–¥–µ–π -->
            <section class="profile-section horses-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <span class="section-icon">üêé</span>
                        –ú–æ–∏ –ª–æ—à–∞–¥–∏
                    </h2>
                    <button class="btn-add-horse" id="addHorseBtn">
                        <span>+</span> –î–æ–±–∞–≤–∏—Ç—å –ª–æ—à–∞–¥—å
                    </button>
                </div>
                <div id="horsesContainer">
                    <div class="no-horses">
                        <p style="font-size: 1.2rem; margin-bottom: 1rem;">üêé –£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –ª–æ—à–∞–¥–µ–π</p>
                        <p style="color: var(--light-text); margin-bottom: 2rem;">–î–æ–±–∞–≤—å—Ç–µ —Å–≤–æ—é –ø–µ—Ä–≤—É—é –ª–æ—à–∞–¥—å, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∞—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</p>
                        <button class="btn-upgrade premium" onclick="showAddHorseModal()">
                            + –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–≤—É—é –ª–æ—à–∞–¥—å
                        </button>
                    </div>
                </div>
            </section>
            
            <!-- –°–µ–∫—Ü–∏—è –∑–∞–∫–∞–∑–æ–≤ -->
            <section class="profile-section orders-section">
                <h2 class="section-title">
                    <span class="section-icon">üì¶</span>
                    –ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤
                </h2>
                <div id="ordersContainer">
                    <div class="no-orders">
                        <p style="font-size: 1.2rem; margin-bottom: 1rem;">üì¶ –£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–∫–∞–∑–æ–≤</p>
                        <p style="color: var(--light-text); margin-bottom: 2rem;">–ü–æ—Å–µ—Ç–∏—Ç–µ –º–∞–≥–∞–∑–∏–Ω –∫–æ—Ä–º–æ–≤, —á—Ç–æ–±—ã —Å–¥–µ–ª–∞—Ç—å –ø–µ—Ä–≤—ã–π –∑–∞–∫–∞–∑</p>
                        <button class="btn-upgrade premium" onclick="window.location.href='{% url 'food_list' %}'">
                            üõí –ü–µ—Ä–µ–π—Ç–∏ –≤ –º–∞–≥–∞–∑–∏–Ω
                        </button>
                    </div>
                </div>
            </section>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è -->
<div class="modal" id="editProfileModal">
    <div class="modal-content">
        <button class="modal-close" id="closeEditModal">√ó</button>
        <h3>‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</h3>
        
        <form id="editProfileForm">
            {% csrf_token %}
            <div class="form-group">
                <label for="editFirstName">–ò–º—è</label>
                <input type="text" id="editFirstName" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è" value="{{ user.first_name }}">
            </div>
            
            <div class="form-group">
                <label for="editLastName">–§–∞–º–∏–ª–∏—è</label>
                <input type="text" id="editLastName" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à—É —Ñ–∞–º–∏–ª–∏—é" value="{{ user.last_name }}">
            </div>
            
            <div class="form-group">
                <label for="editPhone">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                <input type="tel" id="editPhone" placeholder="+7 (XXX) XXX-XX-XX" value="{{ user.profile.phone|default:'' }}">
            </div>
            
            <div class="form-group">
                <label for="editEmail">Email</label>
                <input type="email" id="editEmail" placeholder="your@email.com" value="{{ user.email }}">
            </div>
            
            <div class="form-group">
                <label for="editAddress">–ê–¥—Ä–µ—Å</label>
                <textarea id="editAddress" rows="3" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –∞–¥—Ä–µ—Å">{{ user.profile.address|default:'' }}</textarea>
            </div>
            
            <div class="form-actions">
                <button type="button" class="btn-cancel" id="cancelEditBtn">–û—Ç–º–µ–Ω–∞</button>
                <button type="submit" class="btn-upgrade premium" id="saveProfileBtn">
                    üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
                </button>
            </div>
        </form>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ª–æ—à–∞–¥–∏ -->
<div class="modal" id="addHorseModal">
    <div class="modal-content">
        <button class="modal-close" id="closeHorseModal">√ó</button>
        <h3>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –ª–æ—à–∞–¥—å</h3>
        <form id="addHorseForm">
            {% csrf_token %}
            <div class="form-group">
                <label for="horseName">–ò–º—è –ª–æ—à–∞–¥–∏ *</label>
                <input type="text" id="horseName" required placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è –ª–æ—à–∞–¥–∏">
            </div>
            
            <div class="form-group">
                <label for="horseBreed">–ü–æ—Ä–æ–¥–∞ *</label>
                <select id="horseBreed" required>
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ—Ä–æ–¥—É</option>
                    <option value="ahaltekin">–ê—Ö–∞–ª—Ç–µ–∫–∏–Ω—Å–∫–∞—è</option>
                    <option value="arab">–ê—Ä–∞–±—Å–∫–∞—è</option>
                    <option value="orlov">–û—Ä–ª–æ–≤—Å–∫–∏–π —Ä—ã—Å–∞–∫</option>
                    <option value="trakenen">–¢—Ä–∞–∫–µ–Ω–µ–Ω—Å–∫–∞—è</option>
                    <option value="budyonny">–ë—É–¥—ë–Ω–Ω–æ–≤—Å–∫–∞—è</option>
                    <option value="don">–î–æ–Ω—Å–∫–∞—è</option>
                    <option value="tinker">–¶—ã–≥–∞–Ω—Å–∫–∞—è (—Ç–∏–Ω–∫–µ—Ä)</option>
                    <option value="other">–î—Ä—É–≥–∞—è –ø–æ—Ä–æ–¥–∞</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="horseAge">–í–æ–∑—Ä–∞—Å—Ç (–ª–µ—Ç) *</label>
                <input type="number" id="horseAge" min="1" max="40" required value="5">
            </div>
            
            <div class="form-group">
                <label for="horseColor">–ú–∞—Å—Ç—å</label>
                <input type="text" id="horseColor" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –≥–Ω–µ–¥–∞—è, –≤–æ—Ä–æ–Ω–∞—è">
            </div>
            
            <div class="form-group">
                <label for="horseDescription">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                <textarea id="horseDescription" rows="3" placeholder="–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏, —Ö–∞—Ä–∞–∫—Ç–µ—Ä..."></textarea>
            </div>
            
            <div class="form-actions">
                <button type="button" class="btn-cancel" id="cancelHorseBtn">–û—Ç–º–µ–Ω–∞</button>
                <button type="submit" class="btn-upgrade premium" id="submitHorseBtn">
                    üêé –î–æ–±–∞–≤–∏—Ç—å –ª–æ—à–∞–¥—å
                </button>
            </div>
        </form>
    </div>
</div>

{% csrf_token %}
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/profile.js' %}"></script>
{% endblock %}